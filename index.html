<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ã‚¢ãƒªãƒã‚¢é€æ–™è¦‹ç©ã‚Š</title>
    <link rel="icon" href="symbol_1.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <a
      class="app-logo"
      href="https://worldshift-inc.jp/"
      target="_blank"
      rel="noreferrer"
    >
      <img src="logo_1-1.png" alt="Worldshift" />
    </a>

    <main class="simulation-screen">
      <header class="screen-header">
        <div class="screen-brand">
          <span class="screen-tagline">è·ç‰©ã‚‚æƒ³ã„ã‚‚å±Šã‘ã‚‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€</span>
          <a
            class="screen-brand-name"
            href="https://worldshift-inc.jp/allynair/"
            target="_blank"
            rel="noreferrer"
            >Allynairï¼ˆã‚¢ãƒªãƒã‚¢ï¼‰</a
          >
        </div>
        <h1 class="screen-title">é€æ–™ãŠè¦‹ç©ã‚Š</h1>
      </header>

      <div id="inputScreen" class="screen-section">
        <section class="simulation-card">
          <p class="required-note">
            â€»<span class="required-mark">*</span>ã¯å¿…é ˆå…¥åŠ›é …ç›®ã¨ãªã‚Šã¾ã™
          </p>
          <div class="input-grid">
            <label class="field-label" for="country"
              >é€ã‚Šå…ˆå›½<span class="required-mark">*</span></label
            >
            <div class="country-select-row">
              <div class="select-wrap select-wrap--no-arrow">
                <select id="country" class="field-select field-select--left"></select>
              </div>
              <p class="field-note field-note--inline" id="chinaNotice" hidden>
                â€»ã€Œä¸­å›½å—éƒ¨ã€ã¯é‡æ…¶å¸‚ã€ç¦å»ºçœã€åºƒæ±çœã€æ¹–å—çœã€æ±Ÿè¥¿çœã€åºƒè¥¿ãƒãƒ¯ãƒ³æ—è‡ªæ²»åŒºã€æµ·å—çœã€é›²å—çœ<br />
                ã€Œä¸­å›½åŒ—éƒ¨ã€ã¯ä¸Šè¨˜ä»¥å¤–ã‚’æŒ‡ã—ã¾ã™
              </p>
              <p class="field-note field-note--alert" id="otherCountryNotice" hidden>
                ãƒªã‚¹ãƒˆã«é¸æŠè‚¢ãŒãªã„å›½ã¸ã®ç™ºé€ã¯å€‹åˆ¥ã«è¦‹ç©ã‚‚ã‚Šã„ãŸã—ã¾ã™ã€‚<br />ãŠæ‰‹æ•°ã§ã™ãŒã€ç”»é¢ä¸‹éƒ¨ã®ã€ŒãŠå•åˆã›ã¯ã“ã¡ã‚‰ã€ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„
              </p>
            </div>

            <span class="field-label"
              >æ³•äººï¼å€‹äºº<span class="required-mark">*</span></span
            >
            <div class="radio-group" id="customerTypeGroup">
              <label class="radio-row">
                <input type="radio" name="customerType" value="personal" />
                <span>å€‹äºº</span>
              </label>
              <label class="radio-row">
                <input type="radio" name="customerType" value="corporate" />
                <span>æ³•äºº</span>
              </label>
            </div>

            <span class="field-label" id="planLabel" hidden><span class="plan-tooltip" data-tooltip="LOGIFITãƒ—ãƒ©ãƒ³ãªã‚‰é¢å€’ãª
ãƒ»æ¤œå“ï¼æ¢±åŒ…
ãƒ»è¼¸é€ç”¨æ®µãƒœãƒ¼ãƒ«ã®ç”¨æ„
ãŒä¸è¦ã§ã™âœ¨">ãƒ—ãƒ©ãƒ³<span class="tooltip-indicator" aria-hidden="true"></span></span></span>
            <div class="plan-group" id="planGroup" hidden>
              <div class="radio-group">
                <label class="radio-row">
                  <input type="radio" name="plan" value="LOGIFIT" />
                  <span class="plan-tooltip" data-tooltip="LOGIFITãƒ—ãƒ©ãƒ³ãªã‚‰é¢å€’ãª
ãƒ»æ¤œå“ï¼æ¢±åŒ…
ãƒ»è¼¸é€ç”¨æ®µãƒœãƒ¼ãƒ«ã®ç”¨æ„
ãŒä¸è¦ã§ã™âœ¨">LOGIFIT<span class="tooltip-indicator" aria-hidden="true"></span></span>
                </label>
                <label class="radio-row">
                  <input type="radio" name="plan" value="worldShipForBiz" />
                  <span class="plan-tooltip" data-tooltip="LOGIFITãƒ—ãƒ©ãƒ³ãªã‚‰é¢å€’ãª
ãƒ»æ¤œå“ï¼æ¢±åŒ…
ãƒ»è¼¸é€ç”¨æ®µãƒœãƒ¼ãƒ«ã®ç”¨æ„
ãŒä¸è¦ã§ã™âœ¨">ãƒ¯ãƒ¼ãƒ«ãƒ‰ship for Biz<span class="tooltip-indicator" aria-hidden="true"></span></span>
                </label>
              </div>
              <p class="field-note">
                <a
                  href="https://worldshift-inc.jp/allynair/"
                  target="_blank"
                  rel="noreferrer"
                  >â€»ãƒ—ãƒ©ãƒ³ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’ã”ç¢ºèªãã ã•ã„</a
                >
              </p>
            </div>
          </div>
        </section>

        <section class="box-section">
          <div class="box-section-header">
            <h2 class="box-section-title">ç®±æƒ…å ±</h2>
            <button class="add-box-button" type="button" id="addBoxButton">
              ï¼‹
            </button>
          </div>
          <div class="box-list" id="boxList"></div>
        </section>

        <section class="option-section">
          <div class="option-panel">
            <div class="option-grid">
              <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="PDFå½¢å¼ã§ç™ºè¡Œã—ãƒ¡ãƒ¼ãƒ«ã«ã¦é€ä»˜ã„ãŸã—ã¾ã™">ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™ºè¡Œ<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
              <label class="checkbox-row">
                <input type="checkbox" id="invoiceIssue" />
                <span>åˆ©ç”¨ã™ã‚‹</span>
              </label>

              <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="ã€Šç™ºé€ã™ã‚‹è·ç‰©1ç®±ã«ã¤ãï¿¥1,000ã€‹
å¼Šç¤¾ã«è·ç‰©ã‚’é€ã£ã¦ã„ãŸã ã„ãŸéš›ã€ç™ºé€ã§ããªã„å•†å“ãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆã€ç„¡æ–™ã§è¿”é€ã‚‚ã—ãã¯å»ƒæ£„">è¿”é€ä¿é™º<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
              <label class="checkbox-row">
                <input type="checkbox" id="returnInsurance" />
                <span>åˆ©ç”¨ã™ã‚‹</span>
              </label>

              <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="ã€Šç™ºé€ã™ã‚‹å•†å“ä¾¡æ ¼ã®2.0ï¼…ã€‹
è¼¸é€ä¸­ã®ç ´æãƒ»ç´›å¤±ã—ãŸå ´åˆã€å•†å“ä»£é‡‘ã‚’è¿”é‡‘
â€»å•†å“é‡‘é¡ãŒï¼‘å††æœªæº€ã®ã‚‚ã®ã¯å¯¾è±¡å¤–
â€»ä»¥ä¸‹ã¯å…è²¬ã«ãªã‚Šã¾ã™
ãƒ»è‡ªç„¶ç½å®³ã«ã‚ˆã‚‹è·ç‰©ã®ç´›å¤±ã‚„ç ´æ
ãƒ»æˆ¦äº‰ã‚„æš´å‹•ã«ã‚ˆã‚‹è·ç‰©ã®ç´›å¤±ã‚„ç ´æ">é‹é€ä¿é™º<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
              <div class="insurance-row">
                <label class="checkbox-row">
                  <input type="checkbox" id="cargoInsurance" />
                  <span>åˆ©ç”¨ã™ã‚‹</span>
                </label>
                <div class="insurance-input">
                  <label for="insuredValue">å•†å“ä¾¡æ ¼åˆè¨ˆ</label>
                  <input
                    id="insuredValue"
                    class="field-input"
                    type="number"
                    min="0"
                    step="1"
                    placeholder=""
                    disabled
                  />
                  <span class="unit">å††</span>
                </div>
              </div>
            </div>
            <p class="option-note">â€»é‹é€ä¿é™ºã¯ç™ºé€ã™ã‚‹å•†å“ä¾¡æ ¼ã®2.0ï¼…ã§ã™ã€‚</p>
          </div>
        </section>

        <div class="simulate-row" id="simulateRow">
          <button class="cta-button" type="button" id="simulateButton">
            è¦‹ç©ã‚Šç®—å‡ºã‚¹ã‚¿ãƒ¼ãƒˆ
          </button>
          <a class="secondary-button secondary-button--outline" href="https://forms.gle/cbn4CHYc1obw9maU7" target="_blank" rel="noreferrer">
            ãŠå•åˆã›ã¯ã“ã¡ã‚‰
          </a>
        </div>
        <p class="error-message" id="inputError" hidden></p>
      </div>

      <div id="resultScreen" class="screen-section" hidden>
        <section class="total-row" hidden>
          <span class="total-label">ãŠè¦‹ç©ã‚Šçµæœ</span>
          <span class="total-price"
            ><span id="totalPrice">ãƒ¼</span>
            <span id="totalUnit">å††</span></span
          >
        </section>

        <section class="cta-row" hidden>
          <div class="cta-row-group">
            <a
              class="cta-button cta-button--primary"
              href="https://docs.google.com/forms/d/e/1FAIpQLSd0F2BwC-SIciWrrHSJ9OIwLEU0uJ-9-HHsuqvmxyJbzGJIzQ/viewform"
              target="_blank"
              rel="noreferrer"
              id="applyLink"
            >
              ç”³ã—è¾¼ã¿ã¯ã“ã¡ã‚‰
            </a>
          </div>
          <div class="cta-row-group">
            <button class="secondary-button" type="button" id="retryButton">
              è¦‹ç©ã‚Šã‚’ã‚„ã‚Šç›´ã™
            </button>
            <a
              class="secondary-button secondary-button--accent"
              href="https://docs.google.com/forms/d/e/1FAIpQLSdoEFiaTdnr-6lB_s2KWynHlvZ213CS62Eq4eKefM1_gBh9cA/viewform?usp=pp_url&entry.1685188045=%E8%A6%8B%E7%A9%8D%E3%82%8A%E7%B5%90%E6%9E%9C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6&entry.860373797=AN0000&entry.1267146174=%E9%9F%93%E5%9B%BD"
              target="_blank"
              rel="noreferrer"
              id="estimateInquiryLink"
            >
              è¦‹ç©ã‚Šçµæœã«ã¤ã„ã¦ãŠå•åˆã›
            </a>
            <button class="secondary-button" type="button" id="estimateButton">
              çµæœã‚’PDFã§å‡ºåŠ›
            </button>
          </div>
        </section>

        <section class="disclaimer">
          <h2 class="disclaimer-title">æ³¨æ„äº‹é …</h2>
          <ul class="disclaimer-list">
            <li>ãƒ»æœ¬ãŠè¦‹ç©ã‚‚ã‚Šã¯ç¾æ™‚ç‚¹ã§ã®æ¦‚ç®—é‡‘é¡ã¨ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã®ã”åˆ©ç”¨æ™‚ã«å†…å®¹å¤‰æ›´ã‚„è¿½åŠ è²»ç”¨ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚</li>
            <li>
              ãƒ»è·ç‰©ã®å†…å®¹ã‚„å›½ã«ã‚ˆã£ã¦ã¯é€ã‚‹ã“ã¨ãŒã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™ã®ã§ã€è©³ã—ãã¯ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚’ã”ç¢ºèªãã ã•ã„ã€‚<br />
              <a href="https://drive.google.com/file/d/1C6jVKnMnA-RGuwM8us9dbC737dWL8K7z/view" target="_blank" rel="noreferrer">è¼¸å‡ºä¸å¯ï¼†è¦åˆ¶å“ä¸€è¦§ï¼ˆå…±é€šï¼†å›½ã”ã¨ï¼‰</a>
            </li>
            <li>
              ãƒ»é–¢ç¨ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€å—å–äººå´ã«ã¦ã”è«‹æ±‚ãŒç™ºç”Ÿã—ã¾ã™ã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚ã”äº†æ‰¿ãã ã•ã„ã€‚<br />
              ã€€é–¢ç¨ã®åŸºæœ¬ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ãƒ–ãƒ­ã‚°ã‚’ã”ç¢ºèªãã ã•ã„<br />
              ã€€ã€€<a href="https://worldshift-inc.jp/blog/%e3%80%90%e5%88%9d%e5%bf%83%e8%80%85%e5%90%91%e3%81%91%e3%80%91%e5%80%8b%e4%ba%ba%e3%81%a7%e6%b5%b7%e5%a4%96%e3%81%ab%e8%8d%b7%e7%89%a9%e3%82%92%e9%80%81%e3%82%8b%e5%89%8d%e3%81%ab%e7%9f%a5%e3%81%a3/" target="_blank" rel="noreferrer">ã€åˆå¿ƒè€…å‘ã‘ã€‘å€‹äººã§æµ·å¤–ã«è·ç‰©ã‚’é€ã‚‹å‰ã«çŸ¥ã£ã¦ãŠããŸã„ã€Œé–¢ç¨ã€ã®åŸºæœ¬</a>
            </li>
            <li>ãƒ»é€æ–™ã¯å®Ÿé‡é‡ã¨å®¹ç©é‡é‡ã‚’æ¯”è¼ƒã—ãŸã†ãˆã§ã€æ•°å€¤ãŒå¤§ãã„æ–¹ã‚’åŸºæº–ã«ç®—å‡ºã—ã¦ãŠã‚Šã¾ã™ã€‚</li>
            <li>ãƒ»å¼Šç¤¾ã«é€ä»˜ã„ãŸã ã„ãŸè·ç‰©ã‚’ã€å¼Šç¤¾ã«ã¦å†åº¦ã€å®Ÿé‡é‡ã€‘ã€å®¹ç©é‡é‡ã€‘ã‚’è¨ˆæ¸¬ã—ã€ãã‚Œã‚’åŸºã«é€æ–™ç­‰ã‚’ç®—å‡ºã„ãŸã—ã¾ã™ã€‚<br />
            ã€€ãã®ãŸã‚è¦‹ç©ã‚‚ã‚Šæ™‚ã¨ä¾¡æ ¼ã®å¤‰å‹•ãŒèµ·ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
            <li>ãƒ»LOGIFITãƒ—ãƒ©ãƒ³ã‚’ã”åˆ©ç”¨ã®å ´åˆã¯ã€å¼Šç¤¾ã«ã¦ç”¨æ„ã—ãŸæ®µãƒœãƒ¼ãƒ«ã«è·ç‰©ã‚’æ¢±åŒ…ã—ç›´ã—ãŸã†ãˆã§ã€å†åº¦ã€å®Ÿé‡é‡ã€‘ãŠã‚ˆã³ã€å®¹ç©é‡é‡ã€‘ã‚’è¨ˆæ¸¬ã—ã€é€æ–™ã‚’ç®—å‡ºã„ãŸã—ã¾ã™ã€‚<br />
            ã€€ãã®ãŸã‚è¦‹ç©ã‚‚ã‚Šæ™‚ã¨ä¾¡æ ¼ã®å¤‰å‹•ãŒèµ·ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
            <li>ãƒ»ãŠè¦‹ç©ã‚‚ã‚Šæ›¸ã®æœ‰åŠ¹æœŸé™ã¯å½“æœˆæœ«ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ï¼ˆç¿Œæœˆä»¥é™ã¯ç‡ƒæ–™ã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸ç‡ã®å¤‰æ›´ã«ä¼´ã„ã€è¦‹ç©é‡‘é¡ãŒå¤‰å‹•ã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã®ã§ã€ã”ç•™æ„ãã ã•ã„ã€‚ï¼‰</li>
          </ul>
        </section>
      </div>

      <div class="modal-backdrop" id="estimateModal" hidden>
        <div class="modal-card" role="dialog" aria-modal="true">
          <button class="modal-close" type="button" id="closeModal">
            Ã—
          </button>
          <label class="modal-label" for="companyName">ä¼šç¤¾å(è¦‹ç©æ›¸å®›å…ˆï¼‰</label>
          <input
            id="companyName"
            class="field-input"
            type="text"
            placeholder="ä¼šç¤¾åã‚’å…¥åŠ›"
          />
          <p class="modal-error" id="companyError" hidden>
            ä¼šç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </p>
          <div class="modal-actions">
            <button class="cta-button" type="button" id="createPdf">
              PDFä½œæˆ
            </button>
          </div>
        </div>
      </div>
    </main>

    <script src="countries.js"></script>
    <template id="boxTemplate">
      <div class="box-card">
        <div class="box-card-header">
          <span class="box-card-title"></span>
          <div class="box-card-actions">
            <button class="duplicate-box-button" type="button">
              ç®±æƒ…å ±ã‚’è¤‡è£½ã™ã‚‹
            </button>
            <button class="remove-box-button" type="button">å‰Šé™¤</button>
          </div>
        </div>
        <div class="box-grid">
          <span class="field-label"
            >ã‚µã‚¤ã‚º<span class="required-mark">*</span></span
          >
          <div class="dimension-group">
            <div class="dimension-row">
              <input
                class="field-input field-input--dimension box-length"
                type="number"
                min="0"
                step="10"
                inputmode="decimal"
              />
              <span class="unit">cm</span>
            </div>
            <span class="dimension-multiply">Ã—</span>
            <div class="dimension-row">
              <input
                class="field-input field-input--dimension box-width"
                type="number"
                min="0"
                step="10"
                inputmode="decimal"
              />
              <span class="unit">cm</span>
            </div>
            <span class="dimension-multiply">Ã—</span>
            <div class="dimension-row">
              <input
                class="field-input field-input--dimension box-height"
                type="number"
                min="0"
                step="10"
                inputmode="decimal"
              />
              <span class="unit">cm</span>
            </div>
          </div>

          <label class="field-label"
            >é‡ã•<span class="required-mark">*</span></label
          >
          <div class="weight-row">
            <input
              class="field-input field-input--dimension box-weight"
              type="number"
              min="0"
              step="10"
              inputmode="decimal"
            />
            <span class="unit">kg</span>
            <p class="field-note field-note--alert box-limit-error is-hidden">
              è¦å®šè¶…éã¨ãªã‚‹ã®ã§ç”»é¢ä¸‹éƒ¨ã®ã€ŒãŠå•åˆã›ã¯ã“ã¡ã‚‰ã€ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„
            </p>
          </div>

          <label class="field-label">å•†å“æ•°</label>
          <div class="box-product-field">
            <input
              class="field-input field-input--narrow box-product-count"
              type="number"
              min="0"
              value="0"
            />
            <p class="field-note field-note--alert box-product-error is-hidden">
              â€»å•†å“æ•°ã‚’å…¥åŠ›ãã ã•ã„
            </p>
          </div>

          <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="å•†å“ã«ä¸å‚™ãŒãªã„ã‹ï¼äºˆå®šã•ã‚Œã¦ã„ã‚‹å†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’ç‚¹æ¤œãƒ»ç¢ºèªã„ãŸã—ã¾ã™">æ¤œå“<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
          <label class="checkbox-row">
            <input type="checkbox" class="box-inspection" />
            <span>åˆ©ç”¨ã™ã‚‹</span>
          </label>

          <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="å•†å“ã‚’è¼¸é€ä¸­ã®è¡æ’ƒã‹ã‚‰å®ˆã‚‹ãŸã‚ã«ã€ç·©è¡æã§æ¢±åŒ…ã„ãŸã—ã¾ã™">æ¢±åŒ…<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
          <label class="checkbox-row">
            <input type="checkbox" class="box-packing" />
            <span>åˆ©ç”¨ã™ã‚‹</span>
          </label>

          <span class="field-label"><span class="info-tooltip" tabindex="0" data-tooltip="æµ·å¤–ç™ºé€å‘ã‘ã®ä¸ˆå¤«ãªå°‚ç”¨æ®µãƒœãƒ¼ãƒ«ã§ã™">è¼¸å‡ºç”¨æ®µãƒœãƒ¼ãƒ«<span class="tooltip-indicator" aria-hidden="true">â„¹ï¸</span></span></span>
          <label class="checkbox-row">
            <input type="checkbox" class="box-export" />
            <span>åˆ©ç”¨ã™ã‚‹</span>
          </label>
        </div>
      </div>
    </template>
    <script>
      const countryInput = document.getElementById("country");
      const totalOutput = document.getElementById("totalPrice");
      const totalUnit = document.getElementById("totalUnit");
      const totalLabel = document.querySelector(".total-label");
      const chinaNotice = document.getElementById("chinaNotice");
      const otherCountryNotice = document.getElementById("otherCountryNotice");
      const simulateButton = document.getElementById("simulateButton");
      const simulateRow = document.getElementById("simulateRow");
      const inputScreen = document.getElementById("inputScreen");
      const resultScreen = document.getElementById("resultScreen");
      const customerTypeGroup = document.getElementById("customerTypeGroup");
      const planLabel = document.getElementById("planLabel");
      const planGroup = document.getElementById("planGroup");
      const invoiceInput = document.getElementById("invoiceIssue");
      const returnInsuranceInput = document.getElementById("returnInsurance");
      const cargoInsuranceInput = document.getElementById("cargoInsurance");
      const insuredValueInput = document.getElementById("insuredValue");
      const boxList = document.getElementById("boxList");
      const boxTemplate = document.getElementById("boxTemplate");
      const addBoxButton = document.getElementById("addBoxButton");
      const estimateButton = document.getElementById("estimateButton");
      const retryButton = document.getElementById("retryButton");
      const estimateModal = document.getElementById("estimateModal");
      const closeModal = document.getElementById("closeModal");
      const createPdf = document.getElementById("createPdf");
      const applyLink = document.getElementById("applyLink");
      const estimateInquiryLink = document.getElementById("estimateInquiryLink");
      const companyNameInput = document.getElementById("companyName");
      const companyError = document.getElementById("companyError");
      const logOutput = document.getElementById("logOutput");
      const inputError = document.getElementById("inputError");
      const ctaRow = document.querySelector(".cta-row");
      const totalRow = document.querySelector(".total-row");
      const disclaimer = document.querySelector(".disclaimer");
      const COMPANY_NAME_REQUIRED_PLANS = ["worldShipForBiz", "LOGIFIT"];
      const APPLY_LINK_BASE =
        "https://docs.google.com/forms/d/e/1FAIpQLSd0F2BwC-SIciWrrHSJ9OIwLEU0uJ-9-HHsuqvmxyJbzGJIzQ/viewform";
      const ESTIMATE_INQUIRY_LINK_BASE =
        "https://docs.google.com/forms/d/e/1FAIpQLSdoEFiaTdnr-6lB_s2KWynHlvZ213CS62Eq4eKefM1_gBh9cA/viewform";
      const RECEIPT_QUERY_PARAM = "entry.1696897520";
      const ESTIMATE_INQUIRY_QUERY_PARAMS = {
        inquiryContent: "entry.1685188045",
        customerNumber: "entry.860373797",
        countryName: "entry.1267146174",
      };
      const FORM_QUERY_PARAMS = {
        customerType: "entry.1401542135",
        serviceName: "entry.1029867203",
        countryName: "entry.1267146174",
        packing: "entry.1339505299",
        invoice: "entry.741660248",
        insuredValue: "entry.295734913",
        returnInsurance: "entry.2146525778",
      };
      const BOX_PREFILL_FIELDS = [
        {
          length: "entry.1226232714",
          width: "entry.141744396",
          height: "entry.1429645362",
          weight: "entry.1734532613",
          inspection: "entry.2081957362",
          packing: "entry.547709405",
        },
        {
          length: "entry.1375809707",
          width: "entry.2066293178",
          height: "entry.800333324",
          weight: "entry.1929638866",
          inspection: "entry.618122972",
          packing: "entry.2014095074",
        },
        {
          length: "entry.896114616",
          width: "entry.1067927190",
          height: "entry.804004002",
          weight: "entry.1075609152",
          inspection: "entry.62708490",
          packing: "entry.1503386464",
        },
        {
          length: "entry.473219670",
          width: "entry.992047437",
          height: "entry.1111560054",
          weight: "entry.580760535",
          inspection: "entry.1996352393",
          packing: "entry.110452612",
        },
        {
          length: "entry.315786711",
          width: "entry.186134680",
          height: "entry.436072720",
          weight: "entry.415831729",
          inspection: "entry.868016146",
          packing: "entry.14359172",
        },
        {
          length: "entry.790647882",
          width: "entry.1029315488",
          height: "entry.699095483",
          weight: "entry.696169278",
          inspection: "entry.1076610956",
          packing: "entry.785665323",
        },
        {
          length: "entry.518246925",
          width: "entry.1389370296",
          height: "entry.300789832",
          weight: "entry.368286471",
          inspection: "entry.851621022",
          packing: "entry.1401448223",
        },
        {
          length: "entry.201079987",
          width: "entry.358625188",
          height: "entry.1092816315",
          weight: "entry.1855911706",
          inspection: "entry.592224650",
          packing: "entry.2062462804",
        },
        {
          length: "entry.1385063235",
          width: "entry.1769716138",
          height: "entry.1777426550",
          weight: "entry.17605018",
          inspection: "entry.759439091",
          packing: "entry.1757967821",
        },
        {
          length: "entry.1099956690",
          width: "entry.1091007767",
          height: "entry.1629398278",
          weight: "entry.1972705104",
          inspection: "entry.1153521752",
          packing: "entry.567485226",
        },
      ];
      const EXTRA_BOX_INFO_QUERY_PARAM = "entry.350946257";

      const PRICE_PER_KG = 2000;
      const VOLUME_DIVISOR = 5000;
      const GAS_ENDPOINT =
        "https://script.google.com/macros/s/AKfycbzvZLNaOTOeko6ylWC3MSUDEgdKLaHk4CFLBCNeFcdRxVvK-jKUU1lDNpAVVdwQ8Kt6rA/exec";
      const PLAN_FEES = {
        worldShip: 0,
        worldShipForBiz: 1200,
        LOGIFIT: 1800,
      };
      const INSPECTION_FEE_PER_ITEM = 200;
      const PACKING_FEE_PER_ITEM = 300;
      const EXPORT_CARTON_FEE = 500;
      const INVOICE_FEE = 300;
      const RETURN_INSURANCE_FEE = 400;
      const CARGO_INSURANCE_RATE = 0.02;
      const CARGO_INSURANCE_MESSAGE =
        "é‹é€ä¿é™ºã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯å•†å“ä¾¡æ ¼åˆè¨ˆã‚’ã”å…¥åŠ›ãã ã•ã„";
      const LIMIT_EXCEEDED_MESSAGE =
        "è¦å®šè¶…éã¨ãªã‚‹ã®ã§ç”»é¢ä¸‹éƒ¨ã®ã€ŒãŠå•åˆã›ã¯ã“ã¡ã‚‰ã€ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„";
      const MAX_BOX_WEIGHT_KG = 70;
      const MAX_LONGEST_SIDE_CM = 274;
      const MAX_LENGTH_PLUS_GIRTH_CM = 400;
      const MAX_BOX_COUNT = 100;
      const MAX_BOX_COUNT_MESSAGE = "ç®±æƒ…å ±ã¯æœ€å¤§100ç®±ã¾ã§è¿½åŠ ã§ãã¾ã™";

      const formatNumber = (value) => value.toLocaleString("ja-JP");
      const clamp = (value, min, max) =>
        Math.min(max, Math.max(min, value));
      const logMessage = (message) => {
        if (!logOutput) {
          return;
        }
        const timestamp = new Date().toLocaleTimeString("ja-JP");
        const current =
          logOutput.textContent === "å¾…æ©Ÿä¸­..." ? "" : logOutput.textContent;
        logOutput.textContent = `${current}${current ? "\n" : ""}${timestamp} ${message}`;
      };
      const logErrorDetails = (label, error) => {
        if (!error) {
          logMessage(`${label}: ä¸æ˜ãªã‚¨ãƒ©ãƒ¼`);
          return;
        }
        logMessage(`${label}: ${error.name || "Error"} - ${error.message || error}`);
        if (error.stack) {
          logMessage(`${label} stack: ${error.stack}`);
        }
      };

      window.addEventListener("error", (event) => {
        logMessage(
          `window.error: ${event.message} (${event.filename}:${event.lineno}:${event.colno})`
        );
      });
      window.addEventListener("unhandledrejection", (event) => {
        logErrorDetails("unhandledrejection", event.reason);
      });

      const countryOptions = Array.isArray(COUNTRY_NAMES)
        ? COUNTRY_NAMES
        : [];
      const emptyCountryOption = document.createElement("option");
      emptyCountryOption.value = "";
      emptyCountryOption.textContent = "";
      emptyCountryOption.selected = true;
      countryInput.appendChild(emptyCountryOption);

      countryOptions.forEach((country) => {
        const option = document.createElement("option");
        option.value = country.value;
        option.textContent = country.label;
        countryInput.appendChild(option);
      });

      const updateChinaNotice = () => {
        if (!chinaNotice) {
          return;
        }
        const selectedLabel =
          countryInput.selectedOptions[0]?.textContent || "";
        const shouldShow =
          selectedLabel.includes("ä¸­å›½åŒ—éƒ¨") || selectedLabel.includes("ä¸­å›½å—éƒ¨");
        chinaNotice.hidden = !shouldShow;
      };

      const isOtherCountrySelected = () =>
        countryInput.selectedOptions[0]?.textContent === "ãã®ä»–";

      const updateOtherCountryState = () => {
        if (otherCountryNotice) {
          otherCountryNotice.hidden = !isOtherCountrySelected();
        }
        simulateButton.disabled = isOtherCountrySelected();
      };

      const getCustomerType = () =>
        document.querySelector('input[name="customerType"]:checked')?.value;

      const getSelectedPlan = () =>
        document.querySelector('input[name="plan"]:checked')?.value || "";

      const getBoxPrefillValues = () =>
        Array.from(boxList.querySelectorAll(".box-card")).map((box, index) => {
          const length = Number(box.querySelector(".box-length")?.value || 0);
          const width = Number(box.querySelector(".box-width")?.value || 0);
          const height = Number(box.querySelector(".box-height")?.value || 0);
          const weight = Number(box.querySelector(".box-weight")?.value || 0);
          const productCount = Number(
            box.querySelector(".box-product-count")?.value || 0
          );
          const inspectionCount = box.querySelector(".box-inspection")?.checked
            ? productCount
            : 0;
          const packingCount = box.querySelector(".box-packing")?.checked
            ? productCount
            : 0;
          return {
            index: index + 1,
            length,
            width,
            height,
            weight,
            inspectionCount,
            packingCount,
          };
        });

      const buildApplyLink = ({ customerNumber = "" } = {}) => {
        const params = new URLSearchParams();
        params.set("usp", "pp_url");

        if (customerNumber) {
          params.set(RECEIPT_QUERY_PARAM, customerNumber);
        }

        const customerType = getCustomerType();
        if (customerType === "corporate") {
          params.set(FORM_QUERY_PARAMS.customerType, "æ³•äºº");
          const selectedPlan = getSelectedPlan();
          if (selectedPlan === "LOGIFIT") {
            params.set(FORM_QUERY_PARAMS.serviceName, "LOGIFIT");
          } else if (selectedPlan === "worldShipForBiz") {
            params.set(FORM_QUERY_PARAMS.serviceName, "ãƒ¯ãƒ¼ãƒ«ãƒ‰ship for Biz");
          }
        } else if (customerType === "personal") {
          params.set(FORM_QUERY_PARAMS.customerType, "å€‹äºº");
        }

        const selectedCountryLabel =
          countryInput.selectedOptions[0]?.textContent?.trim() || "";
        if (selectedCountryLabel) {
          params.set(FORM_QUERY_PARAMS.countryName, selectedCountryLabel);
        }

        const boxPrefillValues = getBoxPrefillValues();
        boxPrefillValues.forEach((box, index) => {
          const fieldMap = BOX_PREFILL_FIELDS[index];
          if (!fieldMap) {
            return;
          }
          params.set(fieldMap.length, String(box.length));
          params.set(fieldMap.width, String(box.width));
          params.set(fieldMap.height, String(box.height));
          params.set(fieldMap.weight, String(box.weight));
          params.set(fieldMap.inspection, String(box.inspectionCount));
          params.set(fieldMap.packing, String(box.packingCount));
        });

        if (boxPrefillValues.length > BOX_PREFILL_FIELDS.length) {
          const extraBoxInfo = boxPrefillValues
            .slice(BOX_PREFILL_FIELDS.length)
            .map(
              (box) =>
                `${box.index}ç®±ç›®â‘ ${box.weight}â‘¡${box.length}*${box.width}*${box.height}â‘¢${box.inspectionCount}â‘£${box.packingCount}`
            )
            .join(" ");
          params.set(EXTRA_BOX_INFO_QUERY_PARAM, extraBoxInfo);
        }

        const hasExportCarton = Array.from(
          boxList.querySelectorAll(".box-export")
        ).some((input) => input.checked);
        if (hasExportCarton) {
          params.set(FORM_QUERY_PARAMS.packing, "æ®µãƒœãƒ¼ãƒ«ã‚’å¸Œæœ›ã™ã‚‹");
        }

        if (invoiceInput.checked) {
          params.set(FORM_QUERY_PARAMS.invoice, "ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™ºè¡Œã‚’å¸Œæœ›ã™ã‚‹");
        }

        if (returnInsuranceInput.checked) {
          params.set(
            FORM_QUERY_PARAMS.returnInsurance,
            "è¿”é€ä¿é™ºã‚’å¸Œæœ›ã™ã‚‹"
          );
        }

        const insuredValue = insuredValueInput.value.trim();
        if (insuredValue !== "") {
          params.set(FORM_QUERY_PARAMS.insuredValue, insuredValue);
        }

        return `${APPLY_LINK_BASE}?${params.toString()}`;
      };

      const buildEstimateInquiryLink = ({ customerNumber = "" } = {}) => {
        const params = new URLSearchParams();
        params.set("usp", "pp_url");
        params.set(ESTIMATE_INQUIRY_QUERY_PARAMS.inquiryContent, "è¦‹ç©ã‚Šçµæœã«ã¤ã„ã¦");
        params.set(
          ESTIMATE_INQUIRY_QUERY_PARAMS.customerNumber,
          customerNumber || "AN0000"
        );

        const selectedCountryLabel =
          countryInput.selectedOptions[0]?.textContent?.trim() || "éŸ“å›½";
        params.set(ESTIMATE_INQUIRY_QUERY_PARAMS.countryName, selectedCountryLabel);

        return `${ESTIMATE_INQUIRY_LINK_BASE}?${params.toString()}`;
      };

      const updatePlanVisibility = () => {
        const isCorporate = getCustomerType() === "corporate";
        planLabel.hidden = !isCorporate;
        planGroup.hidden = !isCorporate;
        if (!isCorporate) {
          const selectedPlan = getSelectedPlan();
          if (selectedPlan) {
            document
              .querySelectorAll('input[name="plan"]')
              .forEach((input) => {
                input.checked = false;
              });
          }
        }
      };

      const updateRemoveButtons = () => {
        const boxes = Array.from(boxList.querySelectorAll(".box-card"));
        boxes.forEach((box, index) => {
          const title = box.querySelector(".box-card-title");
          if (title) {
            title.textContent = `${index + 1}ç®±ç›®æƒ…å ±`;
          }
          const removeButton = box.querySelector(".remove-box-button");
          if (removeButton) {
            removeButton.disabled = boxes.length <= 1;
          }
        });
        addBoxButton.disabled = boxes.length >= MAX_BOX_COUNT;
      };

      const getBoxFieldValues = (box) => ({
        length: box.querySelector(".box-length")?.value || "",
        width: box.querySelector(".box-width")?.value || "",
        height: box.querySelector(".box-height")?.value || "",
        weight: box.querySelector(".box-weight")?.value || "",
        productCount: box.querySelector(".box-product-count")?.value || "0",
        inspection: Boolean(box.querySelector(".box-inspection")?.checked),
        packing: Boolean(box.querySelector(".box-packing")?.checked),
        export: Boolean(box.querySelector(".box-export")?.checked),
      });

      const applyBoxFieldValues = (box, values) => {
        const lengthInput = box.querySelector(".box-length");
        const widthInput = box.querySelector(".box-width");
        const heightInput = box.querySelector(".box-height");
        const weightInput = box.querySelector(".box-weight");
        const productCountInput = box.querySelector(".box-product-count");
        const inspectionInput = box.querySelector(".box-inspection");
        const packingInput = box.querySelector(".box-packing");
        const exportInput = box.querySelector(".box-export");

        if (lengthInput) lengthInput.value = values.length;
        if (widthInput) widthInput.value = values.width;
        if (heightInput) heightInput.value = values.height;
        if (weightInput) weightInput.value = values.weight;
        if (productCountInput) productCountInput.value = values.productCount;
        if (inspectionInput) inspectionInput.checked = values.inspection;
        if (packingInput) packingInput.checked = values.packing;
        if (exportInput) exportInput.checked = values.export;
      };

      const addBox = ({ cloneFromBox = null } = {}) => {
        if (!boxTemplate) {
          return;
        }
        const currentBoxCount = boxList.querySelectorAll(".box-card").length;
        if (currentBoxCount >= MAX_BOX_COUNT) {
          setInputError(MAX_BOX_COUNT_MESSAGE);
          updateRemoveButtons();
          return;
        }
        const fragment = boxTemplate.content.cloneNode(true);
        const box = fragment.querySelector(".box-card");
        if (box) {
          const removeButton = box.querySelector(".remove-box-button");
          if (removeButton) {
            removeButton.addEventListener("click", () => {
              box.remove();
              if (inputError && inputError.textContent === MAX_BOX_COUNT_MESSAGE) {
                setInputError("");
              }
              updateRemoveButtons();
              handleInputChange();
            });
          }
          const duplicateButton = box.querySelector(".duplicate-box-button");
          if (duplicateButton) {
            duplicateButton.addEventListener("click", () => {
              addBox({ cloneFromBox: box });
            });
          }
          if (cloneFromBox) {
            applyBoxFieldValues(box, getBoxFieldValues(cloneFromBox));
          }
        }
        boxList.appendChild(fragment);
        updateRemoveButtons();
        updateProductCountErrors();
        updateBoxLimitErrors();
      };

      addBoxButton.addEventListener("click", addBox);

      const updateCargoInsuranceState = () => {
        const enabled = cargoInsuranceInput.checked;
        insuredValueInput.disabled = !enabled;
        insuredValueInput.required = enabled;
        if (!enabled) {
          insuredValueInput.value = "";
        }
      };

      const enforceBoxInputDigitLimits = (target) => {
        if (!(target instanceof HTMLInputElement)) {
          return;
        }
        const isDimensionField =
          target.classList.contains("box-length") ||
          target.classList.contains("box-width") ||
          target.classList.contains("box-height");
        const isWeightField = target.classList.contains("box-weight");
        if (!isDimensionField && !isWeightField) {
          return;
        }

        const maxIntegerDigits = isWeightField ? 2 : 3;
        const normalized = target.value
          .replace(/[ï¼-ï¼™]/g, (digit) =>
            String.fromCharCode(digit.charCodeAt(0) - 0xfee0)
          )
          .replace(/[ï¼Œã€ã€‚]/g, ".");
        const sanitized = normalized.replace(/[^0-9.]/g, "");
        const [rawIntegerPart = "", ...decimalParts] = sanitized.split(".");
        const integerPart = rawIntegerPart.slice(0, maxIntegerDigits);
        const decimalPart = decimalParts.join("").replace(/\./g, "");
        const hasTrailingDot = sanitized.endsWith(".");

        const normalizedInteger = integerPart || (decimalPart ? "0" : "");
        if (hasTrailingDot && decimalPart === "") {
          target.value = `${normalizedInteger}.`;
          return;
        }

        target.value = decimalPart
          ? `${normalizedInteger}.${decimalPart}`
          : normalizedInteger;
      };

      const updateProductCountErrors = () => {
        const boxes = Array.from(boxList.querySelectorAll(".box-card"));
        boxes.forEach((box) => {
          const productCount = Number(
            box.querySelector(".box-product-count")?.value || 0
          );
          const needsCount =
            box.querySelector(".box-inspection")?.checked ||
            box.querySelector(".box-packing")?.checked;
          const productCountError = box.querySelector(".box-product-error");
          if (productCountError) {
            productCountError.classList.toggle(
              "is-hidden",
              !(needsCount && productCount <= 0)
            );
          }
        });
      };

      const hasBoxLimitViolation = (box) => {
        const length = Number(box.querySelector(".box-length")?.value || 0);
        const width = Number(box.querySelector(".box-width")?.value || 0);
        const height = Number(box.querySelector(".box-height")?.value || 0);
        const weight = Number(box.querySelector(".box-weight")?.value || 0);

        const longestSide = Math.max(length, width, height);
        const girth = 2 * (length + width + height - longestSide);
        const lengthPlusGirth = longestSide + girth;

        return (
          weight > MAX_BOX_WEIGHT_KG ||
          longestSide > MAX_LONGEST_SIDE_CM ||
          lengthPlusGirth > MAX_LENGTH_PLUS_GIRTH_CM
        );
      };

      const updateBoxLimitErrors = () => {
        const boxes = Array.from(boxList.querySelectorAll(".box-card"));
        boxes.forEach((box) => {
          const limitError = box.querySelector(".box-limit-error");
          if (!limitError) {
            return;
          }
          limitError.classList.toggle("is-hidden", !hasBoxLimitViolation(box));
        });
      };

      const handleInputChange = () => {
        updateProductCountErrors();
        updateBoxLimitErrors();
        calculate();
        resetSimulationIfNeeded();
      };

      cargoInsuranceInput.addEventListener("change", () => {
        updateCargoInsuranceState();
        handleInputChange();
      });

      let latestRequestId = 0;

      const setInputError = (message) => {
        if (!inputError) {
          return;
        }
        if (message) {
          inputError.textContent = message;
          inputError.hidden = false;
        } else {
          inputError.textContent = "";
          inputError.hidden = true;
        }
      };

      const setSimulationPending = () => {
        if (totalLabel) {
          totalLabel.hidden = true;
        }
        totalOutput.innerHTML = `
          <div class="shipping-loader" role="status" aria-live="polite">
            <span class="truck">ğŸ›«</span>
            <span class="text">é€æ–™ç®—å‡ºä¸­</span>
            <div class="dots" aria-hidden="true">
              <span></span><span></span><span></span>
            </div>
          </div>
        `;
        totalOutput.classList.add("total-price-pending");
        totalOutput.classList.add("total-price-pending--center");
        totalOutput.classList.remove("total-price-message");
        totalUnit.textContent = "";
      };

      const setCtaVisibility = (isVisible) => {
        if (!ctaRow) {
          return;
        }
        ctaRow.hidden = !isVisible;
      };

      const setTotalVisibility = (isVisible) => {
        if (!totalRow) {
          return;
        }
        totalRow.hidden = !isVisible;
      };

      const setDisclaimerVisibility = (isVisible) => {
        if (!disclaimer) {
          return;
        }
        disclaimer.hidden = !isVisible;
      };

      const setInitialSimulationDisplay = () => {
        totalOutput.textContent = "ãƒ¼";
        totalOutput.classList.remove("total-price-pending");
        totalOutput.classList.remove("total-price-pending--center");
        totalOutput.classList.remove("total-price-message");
        totalUnit.textContent = "å††";
        if (totalLabel) {
          totalLabel.hidden = false;
        }
        if (simulateRow) {
          simulateRow.hidden = false;
        }
      };
      let hasSimulationResult = false;
      let latestCustomerNumber = "";

      const resetSimulationIfNeeded = () => {
        if (!hasSimulationResult) {
          return;
        }
        setInitialSimulationDisplay();
        setCtaVisibility(false);
        setDisclaimerVisibility(false);
        setTotalVisibility(false);
        hasSimulationResult = false;
        latestCustomerNumber = "";
        if (applyLink) {
          applyLink.href = APPLY_LINK_BASE;
        }
        if (estimateInquiryLink) {
          estimateInquiryLink.href = buildEstimateInquiryLink();
        }
      };

      const extractShippingTotal = (data) => {
        if (!data || typeof data !== "object") {
          return null;
        }
        if (typeof data.shipping === "number") {
          return data.shipping;
        }
        if (typeof data.shippingFee === "number") {
          return data.shippingFee;
        }
        if (typeof data.simulationTotal === "number") {
          return data.simulationTotal;
        }
        return null;
      };

      const extractCustomerNumber = (data) => {
        if (!data || typeof data !== "object") {
          return "";
        }
        if (typeof data.customerNumber === "string") {
          return data.customerNumber;
        }
        if (typeof data.customerNumber === "number") {
          return String(data.customerNumber);
        }
        return "";
      };

      const calculate = () => {
        const planValue =
          getCustomerType() === "corporate" ? getSelectedPlan() : "worldShip";
        const planFee = PLAN_FEES[planValue] ?? 0;

        const boxes = Array.from(boxList.querySelectorAll(".box-card"));
        let baseTotal = 0;
        let billableTotal = 0;
        let inspectionFee = 0;
        let packingFee = 0;
        let exportFee = 0;

        boxes.forEach((box) => {
          const length = Number(
            box.querySelector(".box-length")?.value || 0
          );
          const width = Number(box.querySelector(".box-width")?.value || 0);
          const height = Number(
            box.querySelector(".box-height")?.value || 0
          );
          const weight = Number(
            box.querySelector(".box-weight")?.value || 0
          );

          const volumetric = (length * width * height) / VOLUME_DIVISOR;
          const billable = Math.max(weight, Math.ceil(volumetric));
          billableTotal += billable;
          baseTotal += billable * PRICE_PER_KG;

          const productCountInput = box.querySelector(".box-product-count");
          const productCountError = box.querySelector(".box-product-error");
          const productCount = clamp(
            Number(productCountInput?.value || 0),
            0,
            99
          );
          if (productCountInput) {
            productCountInput.value = productCount;
          }
          if (productCountError) {
            const needsCount =
              box.querySelector(".box-inspection")?.checked ||
              box.querySelector(".box-packing")?.checked;
            productCountError.hidden = !(needsCount && productCount <= 0);
          }

          inspectionFee += box.querySelector(".box-inspection")?.checked
            ? productCount * INSPECTION_FEE_PER_ITEM
            : 0;
          packingFee += box.querySelector(".box-packing")?.checked
            ? productCount * PACKING_FEE_PER_ITEM
            : 0;
          exportFee += box.querySelector(".box-export")?.checked
            ? EXPORT_CARTON_FEE
            : 0;
        });

        const invoiceFee = invoiceInput.checked ? INVOICE_FEE : 0;
        const returnInsuranceFee = returnInsuranceInput.checked
          ? RETURN_INSURANCE_FEE
          : 0;
        const insuredValue = cargoInsuranceInput.checked
          ? Number(insuredValueInput.value || 0)
          : 0;
        if (cargoInsuranceInput.checked && insuredValue <= 0) {
          return { billable: billableTotal, total: null, hasError: true };
        }
        const cargoInsuranceFee = cargoInsuranceInput.checked
          ? Math.ceil(insuredValue * CARGO_INSURANCE_RATE)
          : 0;

        const optionTotal =
          planFee +
          inspectionFee +
          packingFee +
          exportFee +
          invoiceFee +
          returnInsuranceFee +
          cargoInsuranceFee;
        const total = baseTotal + optionTotal;
        return { billable: billableTotal, total, hasError: false };
      };

      [invoiceInput, returnInsuranceInput, insuredValueInput].forEach(
        (input) => {
          input.addEventListener("change", handleInputChange);
          input.addEventListener("input", handleInputChange);
        }
      );
      countryInput.addEventListener("change", () => {
        updateChinaNotice();
        updateOtherCountryState();
        handleInputChange();
      });
      countryInput.addEventListener("input", () => {
        updateChinaNotice();
        updateOtherCountryState();
      });
      customerTypeGroup.addEventListener("change", () => {
        updatePlanVisibility();
        handleInputChange();
      });
      planGroup.addEventListener("change", handleInputChange);
      boxList.addEventListener("change", handleInputChange);
      boxList.addEventListener("input", handleInputChange);
      boxList.addEventListener("focusout", (event) => {
        enforceBoxInputDigitLimits(event.target);
        handleInputChange();
      });

      updatePlanVisibility();
      updateCargoInsuranceState();
      updateProductCountErrors();
      updateChinaNotice();
      updateOtherCountryState();
      addBox();
      updateProductCountErrors();
      calculate();
      setInitialSimulationDisplay();
      setCtaVisibility(false);
      setTotalVisibility(false);
      setDisclaimerVisibility(false);
      const initialValues = {
        country: countryInput.value,
        customerType: getCustomerType() || "",
        plan: getSelectedPlan(),
        invoiceIssue: invoiceInput.checked,
        returnInsurance: returnInsuranceInput.checked,
        cargoInsurance: cargoInsuranceInput.checked,
        insuredValue: insuredValueInput.value,
      };

      const resetBoxValues = () => {
        boxList.innerHTML = "";
        addBox();
      };

      const resetInputs = () => {
        countryInput.value = initialValues.country;
        document
          .querySelectorAll('input[name="customerType"]')
          .forEach((input) => {
            input.checked = input.value === initialValues.customerType;
          });
        document.querySelectorAll('input[name="plan"]').forEach((input) => {
          input.checked = input.value === initialValues.plan;
        });
        invoiceInput.checked = initialValues.invoiceIssue;
        returnInsuranceInput.checked = initialValues.returnInsurance;
        cargoInsuranceInput.checked = initialValues.cargoInsurance;
        insuredValueInput.value = initialValues.insuredValue;
        resetBoxValues();
        updateProductCountErrors();
        updatePlanVisibility();
        updateCargoInsuranceState();
        updateOtherCountryState();
        calculate();
        setInitialSimulationDisplay();
        setCtaVisibility(false);
        setTotalVisibility(false);
        setDisclaimerVisibility(false);
        hasSimulationResult = false;
      };

      const openModal = () => {
        estimateModal.hidden = false;
        companyError.hidden = true;
        companyNameInput.focus();
      };

      const closeEstimateModal = () => {
        estimateModal.hidden = true;
      };

      const isCompanyNameRequired = () =>
        COMPANY_NAME_REQUIRED_PLANS.includes(getSelectedPlan());

      const generatePdf = (companyName) => {
        const formatDateForFilename = (date) => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, "0");
          const day = String(date.getDate()).padStart(2, "0");
          return `${year}${month}${day}`;
        };
        const safeCompanyName = companyName.replace(/[\\/:*?"<>|]/g, "");
        const today = new Date();
        const fileDate = formatDateForFilename(today);
        const fileTitle = safeCompanyName
          ? `Allynairè¦‹ç©æ›¸_${safeCompanyName}æ§˜_${fileDate}`
          : `Allynairè¦‹ç©æ›¸_${fileDate}`;
        const totalPrice = totalOutput.textContent;
        const estimateDate = new Date().toLocaleDateString("ja-JP");
        const companyLine = companyName
          ? `<div class="company-name">${companyName} æ§˜</div>`
          : "";
        const selectedCountryLabel =
          countryInput.selectedOptions[0]?.textContent || "";
        const selectedPlanLabel =
          getCustomerType() === "corporate"
            ? document.querySelector('input[name="plan"]:checked')
                ?.nextElementSibling?.textContent || ""
            : "ãƒ¯ãƒ¼ãƒ«ãƒ‰ship";
        const selectedCustomerType = getCustomerType()
          ? getCustomerType() === "corporate"
            ? "æ³•äºº"
            : "å€‹äºº"
          : "æœªé¸æŠ";
        const boxSummary = Array.from(
          boxList.querySelectorAll(".box-card")
        ).map((box, index) => {
          const length = box.querySelector(".box-length")?.value || "æœªé¸æŠ";
          const width = box.querySelector(".box-width")?.value || "æœªé¸æŠ";
          const height = box.querySelector(".box-height")?.value || "æœªé¸æŠ";
          const weight = box.querySelector(".box-weight")?.value || "æœªé¸æŠ";
          const productCount = box.querySelector(".box-product-count")?.value || 0;
          const inspection = box.querySelector(".box-inspection")?.checked
            ? "åˆ©ç”¨ã™ã‚‹"
            : "åˆ©ç”¨ã—ãªã„";
          const packing = box.querySelector(".box-packing")?.checked
            ? "åˆ©ç”¨ã™ã‚‹"
            : "åˆ©ç”¨ã—ãªã„";
          const exportCarton = box.querySelector(".box-export")?.checked
            ? "åˆ©ç”¨ã™ã‚‹"
            : "åˆ©ç”¨ã—ãªã„";
          return `#${index + 1}: ${length} Ã— ${width} Ã— ${height} cm / ${weight} kg / å•†å“æ•° ${productCount} / æ¤œå“ ${inspection} / æ¢±åŒ… ${packing} / è¼¸å‡ºç”¨æ®µãƒœãƒ¼ãƒ« ${exportCarton}`;
        });
        const inputRows = `
          <tr><th>é€ã‚Šå…ˆå›½</th><td>${selectedCountryLabel || "æœªé¸æŠ"}</td></tr>
          <tr><th>æ³•äººï¼å€‹äºº</th><td>${selectedCustomerType}</td></tr>
          <tr><th>ãƒ—ãƒ©ãƒ³</th><td>${selectedPlanLabel || "æœªé¸æŠ"}</td></tr>
          <tr><th>ç®±æƒ…å ±</th><td>${boxSummary.join("<br />") || "æœªé¸æŠ"}</td></tr>
          <tr><th>ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™ºè¡Œ</th><td>${invoiceInput.checked ? "åˆ©ç”¨ã™ã‚‹" : "åˆ©ç”¨ã—ãªã„"}</td></tr>
          <tr><th>è¿”é€ä¿é™º</th><td>${returnInsuranceInput.checked ? "åˆ©ç”¨ã™ã‚‹" : "åˆ©ç”¨ã—ãªã„"}</td></tr>
          <tr><th>é‹é€ä¿é™º</th><td>${cargoInsuranceInput.checked ? "åˆ©ç”¨ã™ã‚‹" : "åˆ©ç”¨ã—ãªã„"}</td></tr>
          <tr><th>å•†å“ä¾¡æ ¼åˆè¨ˆ</th><td>${insuredValueInput.value || 0} å††</td></tr>
        `;
        const receiptLine = latestCustomerNumber
          ? `<div class="receipt-no">é¡§å®¢ç•ªå·ï¼š${latestCustomerNumber}</div>`
          : "";
        const previewWindow = window.open("", "_blank");
        if (!previewWindow) {
          return;
        }
        previewWindow.document.write(`
          <!DOCTYPE html>
          <html lang="ja">
            <head>
              <meta charset="utf-8" />
              <title>${fileTitle}</title>
              <style>
                body {
                  font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
                  padding: 32px;
                  color: #151515;
                }
                .header-row {
                  display: flex;
                  justify-content: space-between;
                  align-items: flex-start;
                  margin-bottom: 16px;
                }
                .receipt-no {
                  font-size: 0.95rem;
                  font-weight: 600;
                  margin-bottom: 6px;
                }
                h1 {
                  font-size: 24px;
                  margin: 0;
                  text-align: center;
                  flex: 1;
                }
                .company-name {
                  margin: 8px 0 0;
                  font-size: 1rem;
                  font-weight: 600;
                }
                .estimate-date {
                  font-size: 0.95rem;
                }
                p {
                  margin: 0 0 16px;
                  line-height: 1.6;
                  font-size: 0.9rem;
                }
                .total-amount {
                  font-size: 1.4rem;
                  font-weight: 700;
                  margin: 16px 0 20px;
                }
                table {
                  width: auto;
                  border-collapse: collapse;
                  font-size: 0.6rem;
                }
                th, td {
                  border: 1px solid #ccc;
                  padding: 6px;
                  text-align: left;
                }
                th {
                  width: 220px;
                  background: #f5f5f5;
                }
                td {
                  width: 220px;
                }
                .notes {
                  margin-top: 24px;
                  font-size: 0.85rem;
                  line-height: 1.6;
                  list-style: none;
                  padding-left: 0;
                }
                .notes li {
                  margin-bottom: 8px;
                }
              </style>
            </head>
            <body>
              ${receiptLine}
              <div class="header-row">
                <h1>è¦‹ç©æ›¸</h1>
                <div class="estimate-date">è¦‹ç©ã‚Šæ—¥: ${estimateDate}</div>
              </div>
              ${companyLine}
              <p>ã“ã®åº¦ã¯å¼Šç¤¾ã‚µãƒ¼ãƒ“ã‚¹ Allynair(ã‚¢ãƒªãƒã‚¢)ã®ãŠè¦‹ç©ã‚Šã‚’ã„ãŸã ãã€èª ã«æœ‰é›£ã†ã”ã–ã„ã¾ã™ã€‚</p>
              <p>ä¸‹è¨˜ã®é€šã‚Šæ¦‚ç®—è²»ç”¨ã‚’ç®—å‡ºè‡´ã—ã¾ã—ãŸã®ã§ã€ã”æ¤œè¨ã®ã»ã©å®œã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚</p>
              <div class="total-amount">åˆè¨ˆè¦‹ç©ã‚Šé¡ï¼ˆã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸æ–™è¾¼ã¿ï¼‰: ${totalPrice} å††</div>
              <table>
                ${inputRows}
              </table>
              <ul class="notes">
                <li>â€» é€æ–™ã¯å®Ÿé‡é‡ã¨å®¹ç©é‡é‡ã‚’æ¯”è¼ƒã—ãŸã†ãˆã§ã€æ•°å€¤ãŒå¤§ãã„æ–¹ã‚’åŸºæº–ã«ç®—å‡ºã—ã¦ãŠã‚Šã¾ã™ã€‚</li>
                <li>â€»ã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸ã«ã¯ä¸‹è¨˜ã®é …ç›®ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚<br />â‘  ç‡ƒæ–™ã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸ï¼ˆå¿…ãšç™ºç”Ÿã—ã€é©ç”¨æœŸé–“ã«ã‚ˆã‚Šå¤‰å‹•ã—ã¾ã™ï¼‰<br />â‘¡ ãã®ä»–è¿½åŠ ã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸ï¼ˆå›½éš›é‹é€ä¼šç¤¾ãŠã‚ˆã³é©ç”¨æœŸé–“ã«ã‚ˆã‚Šè¿½åŠ ã•ã‚Œã‚‹è²»ç”¨ã§ã™ï¼‰</li>
                <li>â€»æœ¬è¦‹ç©æ›¸ã®æœ‰åŠ¹æœŸé™ã¯ã€è¦‹ç©ç™ºè¡Œæœˆã®æœ«æ—¥ã¾ã§ã¨ã—ã¾ã™ã€‚<br />ãªãŠã€æœ¬ç”³ã—è¾¼ã¿ãŒç¿Œæœˆã¨ãªã‚‹å ´åˆã¯ã€ä¾¡æ ¼ã®å†ç®—å‡ºï¼ˆå†è¦‹ç©ï¼‰ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ã€äºˆã‚ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
                <li>â€»è·ç‰©ã®å†…å®¹ã‚„å›½ã«ã‚ˆã£ã¦ã¯é€ã‚‹ã“ã¨ãŒã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™ã®ã§ã€è©³ã—ãã¯ãŠå•åˆã›ãã ã•ã„ã€‚</li>
                <li>â€»é–¢ç¨ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€å—å–äººå´ã«ã¦ã”è«‹æ±‚ãŒç™ºç”Ÿã—ã¾ã™ã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
                <li>â€»å¼Šç¤¾ã«é€ä»˜ã„ãŸã ã„ãŸè·ç‰©ã‚’ã€å¼Šç¤¾ã«ã¦å†åº¦ã€å®Ÿé‡é‡ã€‘ã€å®¹ç©é‡é‡ã€‘ã‚’å›³ã‚‰ã›ã¦ã„ãŸã ãã€ãã‚Œã‚’åŸºã«é€æ–™ç­‰ã‚’ç®—å‡ºã„ãŸã—ã¾ã™ã€‚<br />ãã®ãŸã‚è¦‹ç©ã‚‚ã‚Šæ™‚ã¨ä¾¡æ ¼ã®å¤‰å‹•ãŒèµ·ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
                <li>â€»LOGIFITãƒ—ãƒ©ãƒ³ã‚’ã”åˆ©ç”¨ã®å ´åˆã¯ã€å¼Šç¤¾ã«ã¦ç”¨æ„ã—ãŸæ®µãƒœãƒ¼ãƒ«ã«è·ç‰©ã‚’æ¢±åŒ…ã—ç›´ã—ãŸã†ãˆã§ã€å†åº¦ã€å®Ÿé‡é‡ã€‘ãŠã‚ˆã³ã€å®¹ç©é‡é‡ã€‘ã‚’è¨ˆæ¸¬ã—ã€é€æ–™ã‚’ç®—å‡ºã„ãŸã—ã¾ã™ã€‚<br />ãã®ãŸã‚é€æ–™ã«å¤‰å‹•ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚</li>
              </ul>
            </body>
          </html>
        `);
        previewWindow.document.close();
        previewWindow.focus();
        previewWindow.print();
      };

      estimateButton.addEventListener("click", () => {
        if (isCompanyNameRequired()) {
          openModal();
          return;
        }
        generatePdf("");
      });

      estimateInquiryLink?.addEventListener("click", (event) => {
        event.preventDefault();
        const hasSavedEstimate = window.confirm("è¦‹ç©ã‚Šçµæœã¯ä¿å­˜ã—ã¾ã—ãŸã‹ï¼Ÿ");
        if (hasSavedEstimate) {
          window.open(estimateInquiryLink.href, "_blank", "noopener,noreferrer");
          return;
        }
        estimateButton.click();
      });
      closeModal.addEventListener("click", closeEstimateModal);
      estimateModal.addEventListener("click", (event) => {
        if (event.target === estimateModal) {
          closeEstimateModal();
        }
      });

      retryButton.addEventListener("click", () => {
        resultScreen.hidden = true;
        inputScreen.hidden = false;
        if (simulateRow) {
          simulateRow.hidden = false;
        }
        setInputError("");
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      createPdf.addEventListener("click", () => {
        const companyName = companyNameInput.value.trim();
        companyError.hidden = true;
        generatePdf(companyName);
        closeEstimateModal();
      });

      simulateButton.addEventListener("click", async () => {
        if (logOutput) {
          logOutput.textContent = "";
        }
        setInputError("");
        if (simulateRow) {
          simulateRow.hidden = true;
        }
        const isValidCountry = countryOptions.some(
          (country) => country.value === countryInput.value
        );
        const requiredInputs = [
          {
            field: countryInput,
            label: "é€ã‚Šå…ˆå›½",
            isInvalid: () => !isValidCountry,
          },
          {
            field: customerTypeGroup,
            label: "æ³•äººï¼å€‹äºº",
            isInvalid: () => !getCustomerType(),
          },
        ];
        if (getCustomerType() === "corporate") {
          requiredInputs.push({
            field: planGroup,
            label: "ãƒ—ãƒ©ãƒ³",
            isInvalid: () => !getSelectedPlan(),
          });
        }
        const boxCards = Array.from(boxList.querySelectorAll(".box-card"));
        boxCards.forEach((box, index) => {
          const productCount = Number(
            box.querySelector(".box-product-count")?.value || 0
          );
          const needsProductCount =
            box.querySelector(".box-inspection")?.checked ||
            box.querySelector(".box-packing")?.checked;
          const productCountError = box.querySelector(".box-product-error");
          if (productCountError) {
            productCountError.classList.toggle(
              "is-hidden",
              !(needsProductCount && productCount <= 0)
            );
          }
          if (needsProductCount && productCount <= 0) {
            requiredInputs.push({
              field: box.querySelector(".box-product-count"),
              label: "â€»å•†å“æ•°ã‚’å…¥åŠ›ãã ã•ã„",
              isInvalid: () => true,
            });
          }
          const lengthValue = Number(box.querySelector(".box-length")?.value || 0);
          const widthValue = Number(box.querySelector(".box-width")?.value || 0);
          const heightValue = Number(box.querySelector(".box-height")?.value || 0);
          const weightValue = Number(box.querySelector(".box-weight")?.value || 0);
          if (
            lengthValue === 0 ||
            widthValue === 0 ||
            heightValue === 0 ||
            weightValue === 0
          ) {
            requiredInputs.push({
              field: box.querySelector(".box-length"),
              label: "0ä»¥ä¸Šã®æ­£ç¢ºãªæ•°å€¤",
              isInvalid: () => true,
            });
          }
          requiredInputs.push(
            {
              field: box.querySelector(".box-length"),
              label: `${index + 1}ç®±ç›® ã‚µã‚¤ã‚ºï¼ˆç¸¦ï¼‰`,
              isInvalid: (value) => value === "",
            },
            {
              field: box.querySelector(".box-width"),
              label: `${index + 1}ç®±ç›® ã‚µã‚¤ã‚ºï¼ˆæ¨ªï¼‰`,
              isInvalid: (value) => value === "",
            },
            {
              field: box.querySelector(".box-height"),
              label: `${index + 1}ç®±ç›® ã‚µã‚¤ã‚ºï¼ˆé«˜ã•ï¼‰`,
              isInvalid: (value) => value === "",
            },
            {
              field: box.querySelector(".box-weight"),
              label: `${index + 1}ç®±ç›® é‡ã•`,
              isInvalid: (value) => value === "",
            }
          );
        });
        const hasLimitViolation = boxCards.some((box) => hasBoxLimitViolation(box));
        if (hasLimitViolation) {
          setInputError(LIMIT_EXCEEDED_MESSAGE);
          if (simulateRow) {
            simulateRow.hidden = false;
          }
          return;
        }

        const missingField = requiredInputs.find(({ field, isInvalid }) =>
          isInvalid(field?.value)
        );
        if (missingField) {
          setInputError(`${missingField.label}ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`);
          if (simulateRow) {
            simulateRow.hidden = false;
          }
          return;
        }
        const result = calculate();
        if (result?.hasError) {
          setInputError(CARGO_INSURANCE_MESSAGE);
          logMessage("é‹é€ä¿é™ºã®é‡‘é¡ãŒæœªå…¥åŠ›ã®ãŸã‚é€ä¿¡ã‚’ä¸­æ–­ã—ã¾ã—ãŸã€‚");
          if (simulateRow) {
            simulateRow.hidden = false;
          }
          return;
        }

        const boxDetails = boxCards.map((box, index) => {
          const length = Number(box.querySelector(".box-length")?.value || 0);
          const width = Number(box.querySelector(".box-width")?.value || 0);
          const height = Number(box.querySelector(".box-height")?.value || 0);
          const weight = Number(box.querySelector(".box-weight")?.value || 0);
          const volumetric = (length * width * height) / VOLUME_DIVISOR;
          const billableWeightKg = Math.max(weight, Math.ceil(volumetric));
          const productCount = Number(
            box.querySelector(".box-product-count")?.value || 0
          );
          return {
            index: index + 1,
            length,
            width,
            height,
            weight,
            billableWeightKg,
            productCount,
            inspectionCount: box.querySelector(".box-inspection")?.checked
              ? productCount
              : 0,
            packingCount: box.querySelector(".box-packing")?.checked
              ? productCount
              : 0,
            exportCarton: box.querySelector(".box-export")?.checked || false,
          };
        });
        const payload = {
          destinationCountry: countryInput.value,
          customerType: getCustomerType(),
          plan: getCustomerType() === "corporate" ? getSelectedPlan() : "worldShip",
          invoiceIssue: invoiceInput.checked,
          returnInsurance: returnInsuranceInput.checked,
          cargoInsurance: cargoInsuranceInput.checked,
          insuredValue: cargoInsuranceInput.checked
            ? Number(insuredValueInput.value || 0)
            : 0,
          boxDetails,
        };

        resultScreen.hidden = false;
        setCtaVisibility(false);
        setTotalVisibility(true);
        setDisclaimerVisibility(true);

        try {
          setSimulationPending();
          logMessage(`é€ä¿¡å…ˆURL: ${GAS_ENDPOINT}`);
          logMessage(`ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent}`);
          logMessage(`ãƒšãƒ¼ã‚¸URL: ${window.location.href}`);
          logMessage(`é€ä¿¡ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(payload)}`);
          logMessage("GASã«é€ä¿¡ä¸­...");
          const response = await fetch(GAS_ENDPOINT, {
            method: "POST",
            body: JSON.stringify(payload),
          });
          logMessage(`GASå¿œç­”: ${response.status} ${response.statusText}`);
          if (response.ok) {
            const responseText = await response.text();
            logMessage(`GASå¿œç­”æœ¬æ–‡: ${responseText}`);
            const data = responseText ? JSON.parse(responseText) : {};
            const shippingTotal = extractShippingTotal(data);
            latestCustomerNumber = extractCustomerNumber(data);
            if (applyLink) {
              applyLink.href = buildApplyLink({
                customerNumber: latestCustomerNumber,
              });
            }
            if (estimateInquiryLink) {
              estimateInquiryLink.href = buildEstimateInquiryLink({
                customerNumber: latestCustomerNumber,
              });
            }
            if (typeof shippingTotal === "number") {
              totalOutput.textContent = formatNumber(shippingTotal);
              totalOutput.classList.remove("total-price-message");
              totalOutput.classList.remove("total-price-pending");
              totalOutput.classList.remove("total-price-pending--center");
              totalUnit.textContent = "å††";
              if (totalLabel) {
                totalLabel.hidden = false;
              }
              setCtaVisibility(true);
              setDisclaimerVisibility(true);
              hasSimulationResult = true;
              if (simulateRow) {
                simulateRow.hidden = true;
              }
            } else {
              totalOutput.textContent = "ç®—å‡ºçµæœãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ";
              totalOutput.classList.add("total-price-message");
              totalOutput.classList.remove("total-price-pending");
              totalOutput.classList.remove("total-price-pending--center");
              totalUnit.textContent = "";
              if (totalLabel) {
                totalLabel.hidden = false;
              }
              setCtaVisibility(false);
              setDisclaimerVisibility(false);
              hasSimulationResult = false;
              latestCustomerNumber = "";
              if (applyLink) {
                applyLink.href = APPLY_LINK_BASE;
              }
              if (estimateInquiryLink) {
                estimateInquiryLink.href = buildEstimateInquiryLink();
              }
              if (simulateRow) {
                simulateRow.hidden = false;
              }
            }
          } else {
            const errorText = await response.text();
            logMessage(`GASã‚¨ãƒ©ãƒ¼æœ¬æ–‡: ${errorText}`);
            totalOutput.textContent = "é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ";
            totalOutput.classList.add("total-price-message");
            totalOutput.classList.remove("total-price-pending");
            totalOutput.classList.remove("total-price-pending--center");
            totalUnit.textContent = "";
            if (totalLabel) {
              totalLabel.hidden = false;
            }
            setCtaVisibility(false);
            setDisclaimerVisibility(false);
            hasSimulationResult = false;
            latestCustomerNumber = "";
            if (applyLink) {
              applyLink.href = APPLY_LINK_BASE;
            }
            if (estimateInquiryLink) {
              estimateInquiryLink.href = buildEstimateInquiryLink();
            }
            if (simulateRow) {
              simulateRow.hidden = false;
            }
          }
        } catch (error) {
          console.error("GAS request failed", error);
          logErrorDetails("é€šä¿¡ã‚¨ãƒ©ãƒ¼", error);
          totalOutput.textContent = "é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ";
          totalOutput.classList.add("total-price-message");
          totalOutput.classList.remove("total-price-pending");
          totalOutput.classList.remove("total-price-pending--center");
          totalUnit.textContent = "";
          if (totalLabel) {
            totalLabel.hidden = false;
          }
          setCtaVisibility(false);
          setDisclaimerVisibility(false);
          hasSimulationResult = false;
          latestCustomerNumber = "";
          if (applyLink) {
            applyLink.href = APPLY_LINK_BASE;
          }
          if (estimateInquiryLink) {
            estimateInquiryLink.href = buildEstimateInquiryLink();
          }
          if (simulateRow) {
            simulateRow.hidden = false;
          }
          try {
            logMessage("no-cors ãƒ¢ãƒ¼ãƒ‰ã§å†é€ä¿¡ã‚’è©¦è¡Œã—ã¾ã™...");
            const fallbackResponse = await fetch(GAS_ENDPOINT, {
              method: "POST",
              mode: "no-cors",
              body: JSON.stringify(payload),
            });
            logMessage(
              `no-cors å¿œç­”: type=${fallbackResponse.type} status=${fallbackResponse.status}`
            );
          } catch (fallbackError) {
            logErrorDetails("no-cors å†é€ä¿¡å¤±æ•—", fallbackError);
          }
        }
      });
    </script>
  </body>
</html>
